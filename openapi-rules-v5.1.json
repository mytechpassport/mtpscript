{
  "version": "5.1",
  "description": "MTPScript OpenAPI Generation Rules - Annex B",
  "field_ordering": {
    "openapi": ["openapi", "info", "servers", "security", "tags", "externalDocs", "paths", "components"],
    "info": ["title", "description", "termsOfService", "contact", "license", "version"],
    "contact": ["name", "url", "email"],
    "license": ["name", "url"],
    "server": ["url", "description", "variables"],
    "server_variable": ["enum", "default", "description"],
    "security_requirement": ["<security_scheme_name>"],
    "tag": ["name", "description", "externalDocs"],
    "external_docs": ["description", "url"],
    "path_item": ["$ref", "summary", "description", "get", "put", "post", "delete", "options", "head", "patch", "trace", "servers", "parameters"],
    "operation": ["tags", "summary", "description", "externalDocs", "operationId", "parameters", "requestBody", "responses", "callbacks", "deprecated", "security", "servers"],
    "parameter": ["name", "in", "description", "required", "deprecated", "allowEmptyValue", "style", "explode", "allowReserved", "schema", "example", "examples", "content"],
    "request_body": ["description", "content", "required"],
    "response": ["description", "headers", "content", "links"],
    "responses": ["default", "1XX", "2XX", "3XX", "4XX", "5XX"],
    "content": ["<media_type>"],
    "media_type": ["schema", "example", "examples", "encoding"],
    "encoding": ["contentType", "headers", "style", "explode", "allowReserved"],
    "schema": ["$ref", "type", "format", "title", "description", "default", "multipleOf", "maximum", "exclusiveMaximum", "minimum", "exclusiveMinimum", "maxLength", "minLength", "pattern", "maxItems", "minItems", "uniqueItems", "maxProperties", "minProperties", "required", "enum", "not", "allOf", "oneOf", "anyOf", "items", "properties", "additionalProperties", "discriminator", "readOnly", "writeOnly", "xml", "externalDocs", "example", "examples", "deprecated"],
    "discriminator": ["propertyName", "mapping"],
    "xml": ["name", "namespace", "prefix", "attribute", "wrapped"],
    "components": ["schemas", "responses", "parameters", "examples", "requestBodies", "headers", "securitySchemes", "links", "callbacks"],
    "security_scheme": ["type", "description", "name", "in", "scheme", "bearerFormat", "flows", "openIdConnectUrl"],
    "oauth_flow": ["authorizationUrl", "tokenUrl", "refreshUrl", "scopes"],
    "oauth_flows": ["implicit", "password", "clientCredentials", "authorizationCode"],
    "link": ["operationRef", "operationId", "parameters", "requestBody", "description", "server"],
    "callback": ["<expression>"],
    "header": ["description", "required", "deprecated", "allowEmptyValue", "style", "explode", "allowReserved", "schema", "example", "examples"]
  },
  "ref_folding": {
    "algorithm": "deterministic_ref_folding",
    "description": "Replace inline schema definitions with $ref pointers using SHA-256 content-based addressing",
    "steps": [
      "Generate SHA-256 hash of canonical JSON representation of schema",
      "Create component reference using first 8 characters of hash",
      "Replace inline schema with { \"$ref\": \"#/components/schemas/Schema<8char_hash>\" }",
      "Ensure all identical schemas resolve to same reference"
    ],
    "canonical_form": {
      "field_ordering": "alphabetical",
      "whitespace": "minimal",
      "unicode_normalization": "NFC"
    }
  },
  "schema_deduplication": {
    "method": "content_hash_based",
    "hash_function": "SHA-256",
    "collision_handling": "append_counter",
    "scope": "global_per_document",
    "exclusions": ["title", "description", "example", "examples", "default"]
  },
  "path_parameter_ordering": {
    "rule": "lexicographical_by_parameter_name",
    "description": "Path parameters in OpenAPI spec must be ordered alphabetically by parameter name",
    "example": "/users/{id}/posts/{postId} -> parameters: [id, postId]"
  },
  "deterministic_generation": {
    "timestamp_inclusion": false,
    "random_value_exclusion": true,
    "environment_variable_exclusion": true,
    "build_info_exclusion": true,
    "required_properties": ["openapi", "info", "info.version", "info.title", "paths"]
  },
  "validation_rules": {
    "openapi_version": "3.0.3",
    "required_operation_fields": ["responses"],
    "required_response_codes": ["200", "400", "500"],
    "content_type_preference": ["application/json", "application/xml", "text/plain"],
    "schema_validation": "strict",
    "reference_validation": "required"
  }
}
